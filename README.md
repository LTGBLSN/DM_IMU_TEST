# 达妙IMU上手流程



## 配置

先下载官方上位机、说明书

https://gitee.com/kit-miao/dm-imu

![image-20251228144758519](assets/image-20251228144758519.png)

下载后，进入达妙IMU的上位机

![image-20251228145007262](assets/image-20251228145007262.png)

双击运行，如果报错，按照报错指示安装net插件，如果阻止运行，选择仍要运行

![image-20251228145107880](assets/image-20251228145107880.png)

将imu用typec连接到电脑，连接后，刷新串口然后选择串口



![image-20251228145254051](assets/image-20251228145254051.png)

启动后，会有数据刷屏

![image-20251228145316265](assets/image-20251228145316265.png)

进入imu助手界面，会有上位机显示

![image-20251228145335811](assets/image-20251228145335811.png)

单击配置模式，然后根据图片选择

![image-20251228145448281](assets/image-20251228145448281.png)

配置完成后，单击保存参数，退出配置模式，并断开串口，然后重新连接

观察imu的数据是否正常，如yaw轴角度是否有漂移，如果有漂移，进行校准

校准顺序：选择设置模式，电机陀螺仪零偏移校准，然后保证imu完全静止，等待校准完成

![image-20251228145726574](assets/image-20251228145726574.png)

校准完成没有任何提示，等待几秒钟后，imu会自动重启， 此时上位机需要重新断开串口并重新打开

![image-20251228145856468](assets/image-20251228145856468.png)

观察欧拉角变化，如果静止不动状态下各个角度都不会出现漂移，则校准完成

![image-20251228145933731](assets/image-20251228145933731.png)

记住上位机的波特率配置参数，关闭上位机，打开vofa

![image-20251228150019942](assets/image-20251228150019942.png)

将数据模式改为rawdata，并更改为hex模式，波特率等按照上位机的参数设置

![image-20251228150235905](assets/image-20251228150235905.png)

此时有数据流输出，按照手册内的说明书的要求，进行配置

![image-20251228151901928](assets/image-20251228151901928.png)

首先进入设置模式，发送AA 06 01 0D

![image-20251228152024873](assets/image-20251228152024873.png)

串口输出会有些变化，进行imu配置

1. 开启can输出模式AA 0A 02 0D
2. 设置canid     AA 08 BB 0D     其中BB为控制这个imu的id（主动上报跟此无关）
3. 设置mstid    AA 09 BC 0D     其中BC是反回的id，也就是imu发给c板时的id，c板通过这个id去读消息
4. 开启can主动上报   AA 01 18 0D
5. 保存参数  AA 03 01 0D
6. 退出设置模式  AA 06 00 0D

退出设置模式后，串口将不再滚动，因为已经配置为can输出，此处无数据流

![image-20251228152845598](assets/image-20251228152845598.png)

将imu和c板连接，vcc接5v，gnd接gnd，canH接canH，canL接canL

注意c板的5v需要使用电池供电，仅使用下载器供电仅有3v3

![afebaaefe26421d2643837020a7b94bb](assets/afebaaefe26421d2643837020a7b94bb.jpg)



连接好后，c板烧录测试程序，并按照图片连接串口，如果串口有正常输出，则证明imu配置完成，进行代码移植（文件夹内的RM2026_balance_infantry_robot）

![image-20251228160530471](assets/image-20251228160530471.png)



## 代码移植部分：

1. 包含这两个文件

![image-20251228160638353](assets/image-20251228160638353.png)

2. 在大疆can通信中包含此文件

![image-20251228160737055](assets/image-20251228160737055.png)

3. 枚举类型中添加imu的mst id 

![image-20251228160752808](assets/image-20251228160752808.png)

4. 在can中断回调函数加上此函数，注意是can1还是can2，此处图片和接线不符，接线是can2，但是代码展示的是can1，实际imu接在哪个can上就写在哪个can里

![image-20251228160806140](assets/image-20251228160806140.png)

5. 最后就可以使用了(记得包含头文件)

![image-20251228160913474](assets/image-20251228160913474.png)

